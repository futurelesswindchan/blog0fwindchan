# 风风博客开发心得（三）：路由与页面导航实现

> 本文基于 `src/router/index.ts` 及导航组件源码整理。已与 2025/12/12 版本代码对齐，补充了移动端双列布局等新特性。

## 1. 路由系统设计：骨架

路由是单页应用（SPA）的骨架。我们的配置位于 `src/router/index.ts`，整体结构非常清晰：

- **根布局**: 所有页面都包裹在 `MainLayout` 下。
- **重定向**: 访问 `/` 会自动跳到 `/home`。
- **内容区**: `/articles` 下包含 `frontend`、`topics`、`novels` 等子版块。
- **后台管理**: `/admin` 及其子路由负责登录和内容管理（这是旧版文档没提到的，现在已经实装了）。
- **Meta 信息**: 每个路由都带了 `meta.title`，MainLayout 会读取它并通过打字机效果~~不知道是什么bug导致桌面端不显示~~展示在标题栏上。

## 2. 导航组件：桌面与移动端的“两副面孔”

为了适配不同设备，我们写了两个完全独立的导航组件，但它们共享同一套数据结构 `navItems`。

### 2.1 桌面端：NavPanel.vue

这是一个**可收缩的侧边栏**。

- **交互**: 点击顶部的双箭头按钮，侧边栏会在“仅图标”和“图标+文字”之间切换。这是通过 CSS `width` 过渡实现的。
- **前缀匹配**: 你可能注意到了，当你阅读具体文章（如 `/articles/frontend/1`）时，左侧的“文章导航”按钮依然是高亮的。这是因为我们在 `router-link` 上加了一个判断：

  ```html
  :class="{ active: item.matchPrefix && $route.path.startsWith(item.path) }"
  ```

  只要路径以 `/articles` 开头，它就会保持激活状态。

  ~~才不会告诉你仪表盘相关路由其实没写这个功能~~

### 2.2 移动端：MobileNavPanel.vue

这是一个**全屏抽屉**，但它的布局很有意思。

- **双列布局**: 不同于常见的单列列表，我们在移动端使用了 CSS Grid (`grid-template-columns: 1fr 1fr`)，把导航项排成了两列。这样不仅节省了垂直空间，看起来也更像一个现代化的仪表盘。
- **优雅的退出动画**: 很多抽屉组件在关闭时会瞬间消失，体验很差。我们的实现是：
  1.  点击关闭，设置 `isClosing = true`。
  2.  组件应用 `.sliding-out` 类，触发 CSS `slideOut` 动画。
  3.  监听 `@animationend` 事件，动画播完后再通知父组件销毁自己。
      这一套连招让关闭过程丝般顺滑。

## 3. 路由行为与守卫

### 3.1 瞬间回到顶部

你肯定不希望点进新文章时，页面还停留在底部。我们在路由配置里加了这行：

```ts
scrollBehavior() {
  return { top: 0, left: 0, behavior: 'instant' }
}
```

`instant` 关键字保证了跳转是瞬间完成的，没有拖泥带水的滚动动画，更适合阅读类网站。

### 3.2 路由守卫：数据预加载

在 `beforeEach` 中，我们做了一个大胆的决定：**阻塞式预加载**。

当你要去“友链”或“画廊”页时，路由守卫会先去 Store 里拉取数据。只有数据回来了，页面才会跳转。

虽然这可能会让点击后的反应慢个几百毫秒，但它保证了**页面一显示就是有内容的**，避免了进入页面后出现“加载中...”转圈圈的尴尬。配合 CSS 的 `page-transitioning` 过渡类，体验其实非常流畅。

## 4. 小结

路由和导航不仅仅是把页面连起来，更是用户体验的关键一环。

- 桌面端注重**空间利用**（可收缩）。
- 移动端注重**操作效率**（双列布局、大点击区域）。
- 路由层面注重**阅读体验**（瞬间回顶、预加载）。

下一篇，我们将深入**文章内容渲染与 Markdown 支持**，看看那些漂亮的代码高亮是怎么做出来的。

---

> 没有未来的小风酱 著  
> 2025-12-12重写 （已已已已已经与源码核对）
