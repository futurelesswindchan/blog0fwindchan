# 风风博客开发心得（十）：后台管理与 JWT 安全认证

> 本文详细介绍了如何为博客系统构建一个功能完备且设计精良的 CMS 后台，并引入 JWT (JSON Web Token) 保证其安全性。
> **相关代码**：`src/views/admin/`、`src/api/index.ts`、`backend/app.py`

## 1. 设计理念：美学与功能的统一

传统后台管理系统往往注重功能而忽略美学。本项目在设计 CMS 时，力求让后台的操作体验与前台的浏览体验一样优雅。我们采用了以下设计模式：

- **风格一致性**: 后台所有视图（登录、仪表盘、编辑器）均沿用了前台的 **Aero 玻璃拟态** 风格，使用统一的 `glass-container` 样式。
- **无缝编辑模式**: 编辑器采用“阅读即预览”的设计。默认状态下，文章以最终渲染形态展示；点击“修改”后，界面无缝切换为输入模式，实现了真正的 **所见即所得 (In-place Editing)**。

## 2. 后端：CRUD API 与 JWT 认证

### CRUD 接口扩展

在原有的只读（GET）API基础上，我们为 `Article` 模型增加了 `POST` (创建/更新) 和 `DELETE` 方法，构成了完整的 CRUD (增删改查) 操作闭环。

### 引入 JWT 安全认证

为了保护后台接口，我们用 `Flask-JWT-Extended` 替代了之前简易的 Token 方案。

1.  **用户模型**: 在数据库中新增 `User` 表，使用 `Werkzeug` 库对密码进行**哈希存储**。
2.  **登录流程**: `/api/admin/login` 接口在验证用户名和哈希密码后，会签发一个短时效的 `access_token` 和一个长时效的 `refresh_token`。
3.  **接口保护**: 所有敏感操作的 API（如 `save_article`）都通过 `@jwt_required()` 装饰器进行保护，确保只有携带有效 `access_token` 的请求才能访问。

## 3. 前端：三大核心后台视图

### 3.1 登录视图 (`LoginView.vue`)

一个独立的、受路由守卫保护的登录页面。输入正确的管理员凭据后，前端会将 `access_token` 和 `refresh_token` 存入 `localStorage`。

### 3.2 管理仪表盘 (`DashboardView.vue`)

作为后台的入口，它提供了一个清晰的文章列表，展示了标题、分类、日期等信息，并集成了“新建”、“编辑”和“删除”操作的入口。

### 3.3 编辑器视图 (`EditorView.vue`)

这是 CMS 的灵魂。它通过一个 `isEditing` 状态变量，在两种模式间切换：

- **预览模式**: 直接复用 `<ContentTypeWriter>` 组件，以最终渲染效果展示文章。
- **编辑模式**: 将标题、元信息和正文替换为 `<input>`、`<select>` 和 `<textarea>` 控件。

## 4. 前端：Axios 拦截器与自动 Token 刷新

为了实现优雅的认证流程，我们在 `src/api/index.ts` 中配置了 Axios 拦截器：

- **请求拦截器**: 在每个请求发出前，自动从 `adminStore` 中读取 `access_token` 并添加到 `Authorization` 请求头中。
- **响应拦截器**:
  - 监听 `401 Unauthorized` 错误（通常表示 `access_token` 过期）。
  - 自动使用 `refresh_token` 调用后端的 `/api/admin/refresh` 接口来换取新的 `access_token`。
  - 成功换取后，用新 Token 无感地重发之前失败的请求。
  - 如果刷新也失败，则判定用户身份完全失效，强制登出并跳转到登录页。

## 5. 小结

通过以上改造，风风博客从一个只读的展示性网站，进化为了一个功能完整、安全可靠的全栈内容创作平台。开发者现在可以完全脱离代码和数据库，通过美观的 Web 界面来管理博客的全部内容。

---

> 没有未来的小风酱 著
> 2025-12-03 (已与全栈架构同步)
