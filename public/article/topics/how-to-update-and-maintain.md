# 日常维护：如何更新与照顾你线上的博客

> 目标读者：已经成功部署了博客，并想知道如何更新线上网站内容和代码，以及如何处理常见问题的朋友们。

---

## 零、前言：网站是需要“浇水施肥”的！

恭喜你，你的博客已经在云端稳定运行了！但这只是一个开始。

就像一个盆栽 🌱，你需要时常给它浇水、修剪。

当你在本地有了新的代码修改（比如换了个主题色，或者修复了一个 Bug），要怎么安全地同步到线上的服务器呢？网站突然打不开了又该怎么办？

这篇教程就是你的“网站维护手册”，教你成为一名合格的“网站园丁”。

---

## 一、我有新代码了！- 标准线上更新流程

> 每次更新前，请确保你本地的代码已经修改完毕、测试通过，并且已经 `git push` 到你的 GitHub 仓库了！

这个流程分为 **前端更新** 和 **后端更新** 两部分。

> 什么...不知道Git是什么OAO？！  
> 请参考这篇[详细的Git教程](https://www.bilibili.com/video/BV1Hkr7YYEh8/)，学会用 Git 把代码上传到 GitHub！

### 第 1 步：登录服务器，拉取最新代码

```bash
# 登录你的服务器
ssh [你的用户名]@[你的服务器公网IP]

# 进入项目目录
cd ~/[你的项目文件夹名]

# 从 GitHub 拉取最新的改动
git pull origin main
```

### 第 2 步：更新前端（如果改了 `src/` 目录下的vue、ts、css等文件）

这一步是把你的 `.vue` 文件重新打包成浏览器认识的静态文件。

```bash
# (可选，但推荐) 安装/更新依赖
npm install

# 重新构建！
npm run build
```

前端的更新就这么简单！浏览器下次访问时就会加载新的文件。**你可能需要按 `Ctrl+F5` 强制刷新一下才能看到效果哦！**

### 第 3 步：更新后端（如果改了 `backend/` 目录）

后端的代码是在内存里运行的，所以光更新文件没用，**必须重启服务**！

```bash
# 进入后端目录，激活虚拟环境
cd backend
source venv/bin/activate

# (可选，但推荐) 如果你添加了新的 Python 库，更新依赖
pip install -r requirements.txt

# 好了，现在可以退出虚拟环境了
deactivate
cd ..

# 【核心】重启你的博客后台服务！
sudo systemctl restart blog
```

### 第 4 步：验证！

更新完一定要检查一下网站是不是还活着！

```bash
# 检查后端服务状态
sudo systemctl status blog
```

确保你看到的是绿色的 `active (running)`。然后去浏览器刷新你的网站，测试一下新功能。

---

## 二、“救命！我的网站挂了！” - 紧急排错指南

网站突然打不开，通常是 `500 Internal Server Error` 或 `502 Bad Gateway`。

别慌，日志会告诉我们一切。

### 第一步：排查后端服务

```bash
sudo systemctl status blog
```

- 如果显示的是红色的 `failed`，说明你的后端程序启动失败了！大概率是你新提交的代码有 Bug。
- **怎么办？** -> 请看第二步。

### 第二步：查看后端详细日志

这是最重要的排错工具，它会打印出 Python 的所有报错信息。

```bash
# 查看最后 50 行日志，并且不翻页直接显示
sudo journalctl -u blog -n 50 --no-pager
```

- 仔细阅读日志里的 **Traceback** 信息。它会明确告诉你哪个文件的哪一行出了什么错，比如 `SyntaxError` (语法错误) 或者 `ModuleNotFoundError` (某个库没装上)。
- 根据错误提示修复代码，然后重新 `git push` -> `git pull` -> `sudo systemctl restart blog`。

### 第三步：查看 Nginx 错误日志

如果后端服务是 `active (running)` 但网站还是打不开（比如报 502），那可能是 Nginx 和后端“失联”了。

```bash
# 查看 Nginx 的最新错误日志
sudo tail -n 50 /var/log/nginx/error.log
```

- 留意 `connect() to unix:/.../blog.sock failed` (说明后端服务可能挂了) 或者 `(13: Permission denied)` (说明又是文件权限问题) 这类关键信息。

---

## 三、关于数据库变更的特别提醒

如果你修改了 `backend/app.py` 里的 `db.Model` 模型（比如给 `Article` 表加了一个 `views_count` 字段），**上面的更新流程是不够的！**

这涉及到“数据库迁移”，是一个更高级的话题。对于个人博客，最简单的处理方式是：

1.  通过后台把所有文章内容备份出来。
2.  在服务器上运行 `python init_db.py`，它会清空并根据你的新模型重建数据库。
3.  再把文章一篇篇发布回去。

这虽然笨，但对个人项目来说是有效的。未来你可以学习使用 `Flask-Migrate` 这样的专业工具来无损地更新数据库结构。

---

现在，你不仅是网站的创造者，更是它的守护者了。祝你的博客稳定运行，内容常新！( •̀ ω •́ )✧

> 没有未来的小风酱 敬上
